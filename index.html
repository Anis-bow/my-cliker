<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GERB CLICKER 2025</title>
    <style>
        :root { --red: #ff4757; --blue: #54a0ff; --gold: #eccc68; --bg: #0a0b10; }
        body { 
            margin: 0; background: var(--bg); color: white; 
            font-family: 'Segoe UI', sans-serif; height: 100vh; 
            display: flex; flex-direction: column; overflow: hidden;
        }
        * { -webkit-user-select: none; user-select: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        #header { padding: 20px; text-align: center; background: linear-gradient(to bottom, #161b22, transparent); }
        #score { font-size: 3.5rem; font-weight: 900; color: white; text-shadow: 0 0 20px rgba(84, 160, 255, 0.5); }
        #user-tag { font-size: 0.8rem; color: var(--blue); margin-top: 5px; letter-spacing: 1px; }

        #heat-wrap { width: 80%; max-width: 300px; height: 6px; background: #1e272e; margin: 15px auto; border-radius: 10px; overflow: hidden; }
        #heat-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--blue), var(--red)); transition: width 0.1s; }

        #main-stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        #combo-info { font-size: 1.5rem; font-weight: bold; color: var(--gold); height: 30px; margin-bottom: 10px; text-transform: uppercase; }
        
        #gerb { 
            width: 260px; height: 260px; border-radius: 50%; border: 6px solid #1e272e;
            object-fit: cover; transition: transform 0.05s, filter 0.4s; cursor: pointer;
        }
        .locked { filter: grayscale(1) brightness(0.2) blur(2px) !important; pointer-events: none; }

        .pop { position: absolute; font-weight: 900; pointer-events: none; animation: popAnim 0.7s forwards; z-index: 100; }
        @keyframes popAnim { 0% { opacity: 1; transform: translateY(0) scale(1.5); } 100% { opacity: 0; transform: translateY(-130px) scale(0.8); } }

        .modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px);
            display: none; flex-direction: column; z-index: 500; padding: 25px;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .content-box { flex: 1; overflow-y: auto; border-radius: 15px; }
        
        .row { display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 8px; }
        .chat-msg { padding: 10px; background: #1e272e; border-radius: 12px; margin-bottom: 10px; border-left: 3px solid var(--blue); }

        nav { height: 80px; background: #0f1116; display: flex; border-top: 1px solid #1e272e; }
        .n-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.7rem; color: #57606f; }
        .n-btn.active { color: var(--blue); }
        .n-btn i { font-style: normal; font-size: 1.4rem; margin-bottom: 4px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="header">
        <div id="score">...</div>
        <div id="user-tag">–ó–ê–ì–†–£–ó–ö–ê...</div>
        <div id="heat-wrap"><div id="heat-bar"></div></div>
    </div>

    <div id="main-stage">
        <div id="combo-info"></div>
        <img id="gerb" src="gerb.png" draggable="false">
    </div>

    <div id="modal-top" class="modal">
        <div class="modal-header"><h2>üèÜ –¢–û–ü</h2><b onclick="closeModals()">‚úï</b></div>
        <div id="lb-data" class="content-box"></div>
    </div>

    <div id="modal-chat" class="modal">
        <div class="modal-header"><h2>üí¨ –ß–ê–¢</h2><b onclick="closeModals()">‚úï</b></div>
        <div id="chat-data" class="content-box"></div>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <input type="text" id="msg-input" placeholder="–¢–µ–∫—Å—Ç..." style="flex:1; background:#1e272e; border:none; color:white; padding:12px; border-radius:12px;">
            <button onclick="send()" style="background:var(--blue); border:none; padding:0 20px; border-radius:12px; color:white;">‚û§</button>
        </div>
    </div>

    <div id="modal-shop" class="modal">
        <div class="modal-header"><h2>üéÅ –û–ë–ú–ï–ù</h2><b onclick="closeModals()">‚úï</b></div>
        <div class="content-box">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
                <div style="background:#1e272e; padding:15px; border-radius:15px; text-align:center;">
                    <img src="i (5).webp" style="width:60px; height:60px; object-fit: contain;">
                    <div>–ú–∏—à–∫–∞</div><button onclick="buy('–ú–∏—à–∫–∞', 25000)" style="width:100%; margin-top:10px; background:var(--blue); color:white; border:none; padding:8px; border-radius:8px;">25k</button>
                </div>
                <div style="background:#1e272e; padding:15px; border-radius:15px; text-align:center;">
                    <img src="538e404bde2a5b9680bf486cdc6ea4b4.jpg" style="width:60px; height:60px; object-fit: contain;">
                    <div>–†–æ–∑–∞</div><button onclick="buy('–†–æ–∑–∞', 30000)" style="width:100%; margin-top:10px; background:var(--blue); color:white; border:none; padding:8px; border-radius:8px;">30k</button>
                </div>
                <div style="background:#1e272e; padding:15px; border-radius:15px; text-align:center;">
                    <img src="png-transparent-emojipedia-heart-ribbon-emoticon-emoji-love-ribbon-heart.png" style="width:60px; height:60px; object-fit: contain;">
                    <div>–°–µ—Ä–¥—Ü–µ</div><button onclick="buy('–°–µ—Ä–¥—Ü–µ', 20000)" style="width:100%; margin-top:10px; background:var(--blue); color:white; border:none; padding:8px; border-radius:8px;">20k</button>
                </div>
                <div style="background:#1e272e; padding:15px; border-radius:15px; text-align:center;">
                    <img src="default.png" style="width:60px; height:60px; object-fit: contain;">
                    <div>–ü–æ–¥–∞—Ä–æ–∫</div><button onclick="buy('–ü–æ–¥–∞—Ä–æ–∫', 50000)" style="width:100%; margin-top:10px; background:var(--blue); color:white; border:none; padding:8px; border-radius:8px;">50k</button>
                </div>
            </div>
        </div>
    </div>

    <nav>
        <div class="n-btn active" id="btn-home" onclick="closeModals()"><i>üè†</i>–ò–ì–†–ê</div>
        <div class="n-btn" id="btn-top" onclick="show('modal-top')"><i>üèÜ</i>–¢–û–ü</div>
        <div class="n-btn" id="btn-chat" onclick="show('modal-chat')"><i>üí¨</i>–ß–ê–¢</div>
        <div class="n-btn" id="btn-shop" onclick="show('modal-shop')"><i>üéÅ</i>–û–ë–ú–ï–ù</div>
    </nav>

    <script>
        const API = "https://clikercomee-default-rtdb.firebaseio.com";
        let nick = localStorage.getItem('player_nick');
        if (!nick) {
            nick = prompt("–í–í–ï–î–ò–¢–ï –ù–ò–ö –î–õ–Ø –ò–ì–†–´:");
            if (!nick) nick = "User" + Math.floor(Math.random()*999);
            localStorage.setItem('player_nick', nick);
        }

        let score = 0, heat = 0, combo = 0, mult = 1, isLocked = false;
        let lastClickTime = Date.now();

        // 1. –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ü–†–ò –í–•–û–î–ï
        async function initGame() {
            try {
                const res = await fetch(`${API}/players/${nick}.json`);
                const data = await res.json();
                if (data && data.s !== undefined) {
                    score = data.s;
                }
            } catch(e) { console.log("New user"); }
            updateUI();
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score).toLocaleString();
            document.getElementById('user-tag').innerText = nick.toUpperCase();
            document.getElementById('heat-bar').style.width = heat + "%";
            document.getElementById('combo-info').innerText = combo > 5 ? `üî• COMBO X${mult}` : "";
        }

        function clicker(e) {
            if (isLocked) return;

            lastClickTime = Date.now();
            heat += 2; // –†–æ–≤–Ω–æ 50 –∫–ª–∏–∫–æ–≤ –¥–æ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞

            if (heat >= 100) {
                isLocked = true; heat = 100; combo = 0; mult = 1;
                document.getElementById('gerb').classList.add('locked');
                setTimeout(() => { 
                    isLocked = false; heat = 0; 
                    document.getElementById('gerb').classList.remove('locked');
                    updateUI();
                }, 4000);
            }

            combo++;
            mult = combo > 100 ? 10 : (combo > 50 ? 5 : (combo > 15 ? 2 : 1));
            
            let val = 1 * mult;
            score += val;
            
            const p = document.createElement('div');
            p.className = 'pop'; p.innerText = `+${val}`;
            p.style.left = (e.clientX || e.touches[0].clientX) + "px";
            p.style.top = (e.clientY || e.touches[0].clientY) + "px";
            p.style.color = mult > 1 ? "var(--gold)" : "white";
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 700);
            updateUI();
        }

        // 2. –°–ë–†–û–° –ö–û–ú–ë–û –ü–†–ò –ë–ï–ó–î–ï–ô–°–¢–í–ò–ò
        setInterval(() => {
            if (Date.now() - lastClickTime > 1500 && combo > 0) {
                combo = 0;
                mult = 1;
                updateUI();
            }
        }, 500);

        async function send() {
            const i = document.getElementById('msg-input');
            if(!i.value) return;
            await fetch(`${API}/chat.json`, { method: 'POST', body: JSON.stringify({u: nick, m: i.value, t: Date.now()}) });
            i.value = ''; loadChat();
        }

        async function loadChat() {
            const res = await fetch(`${API}/chat.json`);
            const data = await res.json();
            const b = document.getElementById('chat-data'); b.innerHTML = '';
            if(!data) return;
            Object.values(data).slice(-30).forEach(m => {
                b.innerHTML += `<div class="chat-msg"><b>${m.u}</b>: ${m.m}</div>`;
            });
            b.scrollTop = b.scrollHeight;
        }

        async function loadTop() {
            const res = await fetch(`${API}/players.json`);
            const data = await res.json();
            const b = document.getElementById('lb-data'); b.innerHTML = '';
            if(!data) return;
            Object.entries(data).sort((a,b) => b[1].s - a[1].s).slice(0,15).forEach((p, i) => {
                b.innerHTML += `<div class="row"><span>${i+1}. ${p[0]}</span><b>${Math.floor(p[1].s).toLocaleString()}</b></div>`;
            });
        }

        async function buy(name, cost) {
            if (score < cost) { alert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); return; }
            let tg = prompt("–í–∞—à –¢–µ–ª–µ–≥—Ä–∞–º –¥–ª—è —Å–≤—è–∑–∏:");
            if (!tg) return;
            score -= cost;
            await fetch(`${API}/orders.json`, { method: 'POST', body: JSON.stringify({u: nick, item: name, tg: tg, t: Date.now()}) });
            alert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!");
            updateUI();
        }

        function show(id) {
            closeModals();
            document.getElementById(id).style.display = 'flex';
            document.getElementById('btn-' + id.split('-')[1]).classList.add('active');
            if(id === 'modal-top') loadTop();
            if(id === 'modal-chat') loadChat();
        }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            document.querySelectorAll('.n-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-home').classList.add('active');
        }

        // –û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ –∏ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        setInterval(() => { if(heat > 0 && !isLocked) { heat -= 1; updateUI(); } }, 300);
        setInterval(async () => { 
            if (nick) await fetch(`${API}/players/${nick}.json`, { method: 'PUT', body: JSON.stringify({s: score}) }); 
        }, 5000);

        const target = document.getElementById('gerb');
        target.addEventListener('touchstart', (e) => { e.preventDefault(); clicker(e); });
        target.addEventListener('mousedown', (e) => clicker(e));

        initGame(); // –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    </script>
</body>
</html>
